<!DOCTYPE html>

<html lang="ru">

<head>
    <title>RMT tools</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <style>
        .column {
            float: left;
            width: 100%;
            margin-top: 2px;
            margin-bottom: 2px;
        }

        .btn {
            float: left;
            width: 100%;
            margin: 2px;

        }

        .cl1 {
            float: left;
            width: 100%;
            margin: 2px;
            margin-top: 2px;
            margin-bottom: 2px;
        }

        .cl01 {
            float: left;
            width: 100%;
            text-align: center;
            margin-top: 2px;
            margin-bottom: 2px;
        }

        .cl02 {
            float: left;
            width: 48%;
            text-align: center;
            margin-top: 2px;
            margin-bottom: 2px;
        }

        .cl03 {
            float: left;
            width: 32%;
            text-align: center;
            margin-top: 2px;
            margin-bottom: 2px;
        }

        .cl04 {
            float: left;
            width: 24%;
            text-align: center;
            margin-top: 2px;
            margin-bottom: 2px;
        }

        .cl34 {
            float: left;
            width: 74%;
            text-align: center;
            margin-top: 2px;
            margin-bottom: 2px;
        }

        .cl05 {
            float: left;
            width: 19%;
            text-align: center;
            margin-top: 2px;
            margin-bottom: 2px;
        }

        .hdr {
            float: left;
            width: 100%;
            text-align: center;
            color: white;
            background-color: blue;
            padding: 5px;
            margin: 5px;
        }
    </style>

</head>

<body>
    <div class="hdr">Go Home</div>

    <div class="column">
        <button class="btn" id="goHome">Home Page</button>
    </div>

    <div class="cl1">

        <div class="cl04">
            <label class="cl01" for="RMTGPIOOut">RMT GPIO Out</label>
            <select class="cl01" id="RMTGPIOOut">
                <option value="0" selected>0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
                <option value="13">13</option>
                <option value="14">14</option>
                <option value="15">15</option>
                <option value="16">16</option>
                <option value="17">17</option>
                <option value="18">18</option>
                <option value="19">19</option>
                <option value="20">20</option>
                <option value="21">21</option>
                <option value="22">22</option>
                <option value="23">23</option>
                <option value="24">24</option>
                <option value="25">25</option>
                <option value="26">26</option>
                <option value="27">27</option>
                <option value="28">28</option>
                <option value="29">29</option>
                <option value="30">30</option>
                <option value="31">31</option>
                <option value="32">32</option>
                <option value="33">33</option>
                <option value="34">34</option>
                <option value="35">35</option>
                <option value="36">36</option>
                <option value="37">37</option>
                <option value="38">38</option>
                <option value="39">39</option>
                <option value="40">40</option>
                <option value="41">41</option>
                <option value="42">42</option>
                <option value="43">43</option>
                <option value="44">44</option>
                <option value="45">45</option>
                <option value="46">46</option>
                <option value="47">47</option>
                <option value="48">48</option>
            </select>
        </div>

        <div class="cl04">
            <label class="cl01" for="RMTClkOut">RMT Clock Out (hz)</label>
            <select class="cl01" id="RMTClkOut">
                <option value="1000000" selected>1 MHz 1 mkSek</option>
                <option value="2000000">2 MHz 500 nSek</option>
                <option value="5000000">5 MHz 200 nSek</option>
                <option value="10000000">10 MHz 100 nSek</option>
                <option value="20000000">20 MHz 50 nSek</option>
                <option value="40000000">40 MHz 25 nSek</option>
                <option value="80000000">80 MHz 12.5 nSek</option>
            </select>
        </div>
        <div class="cl04">
            <label class="cl01" for="RMTLoopOut">RMT loop 10 sek</label>
            <input type="checkbox" class="cl01" id="RMTLoopOut">
        </div>
        <div class="cl04">
            <label class="cl01" for="RMTTrigGPIO">RMT Trigger GPIO</label>
            <select class="cl01" id="RMTTrigGPIO">
                <option value="-1" selected>Disable</option>
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
                <option value="13">13</option>
                <option value="14">14</option>
                <option value="15">15</option>
                <option value="16">16</option>
                <option value="17">17</option>
                <option value="18">18</option>
                <option value="19">19</option>
                <option value="20">20</option>
                <option value="21">21</option>
                <option value="22">22</option>
                <option value="23">23</option>
                <option value="24">24</option>
                <option value="25">25</option>
                <option value="26">26</option>
                <option value="27">27</option>
                <option value="28">28</option>
                <option value="29">29</option>
                <option value="30">30</option>
                <option value="31">31</option>
                <option value="32">32</option>
                <option value="33">33</option>
                <option value="34">34</option>
                <option value="35">35</option>
                <option value="36">36</option>
                <option value="37">37</option>
                <option value="38">38</option>
                <option value="39">39</option>
                <option value="40">40</option>
                <option value="41">41</option>
                <option value="42">42</option>
                <option value="43">43</option>
                <option value="44">44</option>
                <option value="45">45</option>
                <option value="46">46</option>
                <option value="47">47</option>
                <option value="48">48</option>
            </select>
        </div>
        <div class="cl1">
            <div class="cl04">
                <label class="cl01" for="RMTOutnSmkSMs">RMT Data nS mkS mS</label>
                <select class="cl01" id="RMTOutnSmkSMs">
                    <option value="1">nSek</option>
                    <option value="1000" selected>mkSek</option>
                    <option value="1000000">mSek</option>
                </select>
            </div>
            <div class="cl34">
                <label class="cl01" for="RMTWriteData">RMT Transmit Data ( space sparated data pair ) </label>
                <input class="cl01" id="RMTWriteData">
            </div>
        </div>

    </div>
    <div class="column">
        <button class="btn" id="RMTStartOut">RMT Transmit</button>
    </div>

    <div class="cl1">

        <div class="cl04">
            <label class="cl01" for="RMTGPIOIn">RMT GPIO Input</label>
            <select class="cl01" id="RMTGPIOIn">
                <option value="0" selected>0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
                <option value="13">13</option>
                <option value="14">14</option>
                <option value="15">15</option>
                <option value="16">16</option>
                <option value="17">17</option>
                <option value="18">18</option>
                <option value="19">19</option>
                <option value="20">20</option>
                <option value="21">21</option>
                <option value="22">22</option>
                <option value="23">23</option>
                <option value="24">24</option>
                <option value="25">25</option>
                <option value="26">26</option>
                <option value="27">27</option>
                <option value="28">28</option>
                <option value="29">29</option>
                <option value="30">30</option>
                <option value="31">31</option>
                <option value="32">32</option>
                <option value="33">33</option>
                <option value="34">34</option>
                <option value="35">35</option>
                <option value="36">36</option>
                <option value="37">37</option>
                <option value="38">38</option>
                <option value="39">39</option>
                <option value="40">40</option>
                <option value="41">41</option>
                <option value="42">42</option>
                <option value="43">43</option>
                <option value="44">44</option>
                <option value="45">45</option>
                <option value="46">46</option>
                <option value="47">47</option>
                <option value="48">48</option>
            </select>
        </div>

        <div class="cl04">
            <label class="cl01" for="RMTClkIn">RMT Clock In</label>
            <select class="cl01" id="RMTClkIn">
                <option value="1000000" selected>1 MHz 1 mkSek</option>
                <option value="2000000">2 MHz 500 nSek</option>
                <option value="5000000">5 MHz 200 nSek</option>
                <option value="10000000">10 MHz 100 nSek</option>
                <option value="20000000">20 MHz 50 nSek</option>
                <option value="40000000">40 MHz 25 nSek</option>
                <option value="80000000">80 MHz 12.5 nSek</option>
            </select>
        </div>
        <div class="cl04">
            <label class="cl01" for="RMTEOFMarker">RMT EOF Marker</label>
            <select class="cl01" id="RMTEOFMarker">
                <option value="1000">1 mkSek</option>
                <option value="10000">10 mkSek</option>
                <option value="100000">100 mkSek</option>
                <option value="1000000">1 mSek</option>
                <option value="10000000" selected>10 mSek</option>
                <option value="50000000">50 mSek</option>
            </select>
        </div>
        <div class="cl04">
            <label class="cl01" for="RMTInOutShort">RMT In/Out short</label>
            <input type="checkbox" class="cl01" id="RMTInOutShort">
        </div>
    </div>
    <div class="column">
        <button class="btn" id="RMTStartIn">RMT Receive (10 sek timeout)</button>
    </div>
    <div class="cl1">
        <div id="LogArea" class="cl02">
            <textarea id="logtext" rows="24" cols="40"></textarea>
        </div>
        <div class="cl02">

        </div>
    </div>

    <script>

        document.getElementById("RMTTrigGPIO").addEventListener("change", function (e) {
            sock_send(JSON.stringify({ name: "RMTTrigGPIO", msg: document.getElementById("RMTTrigGPIO").value }));
        });

        document.getElementById("RMTStartOut").addEventListener("click", function (e) {
            sock_send(JSON.stringify({ name: "RMTGPIOOut", msg: document.getElementById("RMTGPIOOut").value }));
            sock_send(JSON.stringify({ name: "RMTClkOut", msg: document.getElementById("RMTClkOut").value }));
            sock_send(JSON.stringify({ name: "RMTOutnSmkSMs", msg: document.getElementById("RMTOutnSmkSMs").value }));
            sock_send(JSON.stringify({ name: "RMTLoopOut", msg: document.getElementById("RMTLoopOut").checked ? "1" : "0" }));
            sock_send(JSON.stringify({ name: "RMTWriteData", msg: document.getElementById("RMTWriteData").value }));
            sock_send(JSON.stringify({ name: "RMTStartOut", msg: "RMTStartOut" }));
        });

        document.getElementById("RMTStartIn").addEventListener("click", function (e) {
            sock_send(JSON.stringify({ name: "RMTGPIOIn", msg: document.getElementById("RMTGPIOIn").value }));
            sock_send(JSON.stringify({ name: "RMTClkIn", msg: document.getElementById("RMTClkIn").value }));
            sock_send(JSON.stringify({ name: "RMTEOFMarker", msg: document.getElementById("RMTEOFMarker").value }));
            sock_send(JSON.stringify({ name: "RMTInOutShort", msg: document.getElementById("RMTInOutShort").checked ? "1" : "0" }));
            sock_send(JSON.stringify({ name: "RMTStartIn", msg: "RMTStartIn" }));
        });

        document.getElementById("goHome").addEventListener("click", function (e) {
            //onclick="window.location.href = '/'"
            socket.close();
            window.location.href = '/';
        });

        function receiveWsData(data) {
            try {
                let obj = JSON.parse(data);
                //console.log(obj);
                document.getElementById(obj.name).value = obj.msg;
                if (obj.name == "RMTLoopOut" || obj.name == "RMTInOutShort") { obj.msg == "1" ? document.getElementById(obj.name).checked = true : document.getElementById(obj.name).checked = false }
            }
            catch
            {
                //console.log("catch" + data);
                textstr.value = textstr.value + "Receive " + data + '\n';
            }
        }
    </script>

    <script>  // Прием, обработка и отправка данных в WS
    </script>

    <script> // основной старт скрипта, открыть сокет
        // создать сокет по адресу
        let protocol = "ws:"
        if (document.location.protocol == "https:") protocol = "wss:"
        let wsHostStr = protocol + "//" + document.location.host + document.location.pathname;
        wsHostStr += (document.location.pathname == '/') ? "ws" : "/ws";
        var socket = new WebSocket(wsHostStr);
        let textstr = document.getElementById("logtext");
    </script>

    <script> // события WS

        // socket.send -> test only
        function sock_send(e) {
            socket.send(e);
            //console.log(e);
            //textstr.value = textstr.value + "Send " + e + '\n' ;
        };

        socket.onopen = function () {
            console.log("connect");
        };
        socket.onclose = function (event) {
            console.log("close");
            //                setTimeout(() => document.location.reload(), 2000);
        };
        socket.onerror = function () {
            console.log("error");
            //                setTimeout(() => document.location.reload(), 2000);
        };
        socket.onmessage = function (event) {
            receiveWsData(event.data);
        };
    </script>

</body>

</html>